
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- <title>Training-Inference Mismatch In LLM KD</title> -->

        <link rel="stylesheet" href="https://cdn.bootcss.com/reveal.js/3.4.1/css/reveal.min.css">

        <!-- style -->

        <style>

            .reveal.fullscreen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 1000;
                background-color: white;
            }

            .reveal:not(.fullscreen) {
                width: 100%;
                height: 600px;
                margin: 2rem 0;
                position: relative;
            }

            #fullscreen-btn {
                position: absolute;
                top: 20px;
                right: 20px;
                width: 32px;
                height: 32px;
                background-color: rgba(0, 0, 0, 0.6);
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                z-index: 1001;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            #laser-btn {
                position: fixed;
                left: 20px;
                bottom: 20px;
                width: 32px;
                height: 32px;
                background-color: rgba(0, 0, 0, 0.6);
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                z-index: 1001;
                display: none;
                align-items: center;
                justify-content: center;
            }

            #laser-btn:hover {
                background-color: rgba(0, 0, 0, 0.8);
            }

            #laser-btn.active {
                background-color: rgba(255, 0, 0, 0.6);
            }

            .laser-pointer {
                position: fixed;
                width: 0.6rem;
                height: 0.6rem;
                background-color: red;
                border-radius: 50%;
                pointer-events: none;
                z-index: 9999;
                display: none;
                box-shadow: 0 0 0.25rem 0.15rem rgba(255, 0, 0, 0.5);
            }

            .cursor-hidden {
                cursor: none !important;
            }
            
            .cursor-hidden * {
                cursor: none !important;
            }

            .reveal .slides section:not(:first-child) {
                top: 0 !important;
                transform: none !important;
            }
            
            /* åªå–æ¶ˆéé¦–é¡µçš„å‚ç›´å±…ä¸­ */
            .reveal .slides section:not(:first-child) {
                top: 0 !important;
                bottom: 0 !important;
                transform: none !important;
            }

            /* é¦–é¡µä¿æŒ Reveal.js é»˜è®¤çš„å‚ç›´å±…ä¸­ */
            .reveal .slides section:first-child h1,
            .reveal .slides section:first-child h2,
            .reveal .slides section:first-child h3 {
                text-align: center;
                text-transform: capitalize;
                font-size: 6em;
            }

            /* å…¶ä»–é¡µé¢çš„æ ‡é¢˜å›ºå®šåœ¨å·¦ä¸Šè§’ */
            .reveal .slides section:not(:first-child) h1,
            .reveal .slides section:not(:first-child) h2,
            .reveal .slides section:not(:first-child) h3 {
                position: absolute;
                top: 0;
                left: -4rem;
            }

            /* ä¸ºä¸åŒçº§åˆ«çš„æ ‡é¢˜è®¾ç½®ä¸åŒçš„å­—ä½“å¤§å° */
            .reveal .slides section:not(:first-child) h1 { font-size: 55px; }
            .reveal .slides section:not(:first-child) h2 { font-size: 55px; }
            .reveal .slides section:not(:first-child) h3 { font-size: 45px; }

            /* ä¸ºæ•´ä¸ª section æ·»åŠ ä¸Šå†…è¾¹è·ï¼Œé˜²æ­¢å†…å®¹ä¸æ ‡é¢˜é‡å  */
            .reveal .slides section:not(:first-child) {
                padding-top: 1.7em; 
            }

            /* å…¶ä»–é¡µé¢çš„ä¸»è¦å†…å®¹åŒºåŸŸæ·»åŠ ä¸Šè¾¹è· */
            .reveal .slides section:not(:first-child) > *:not(h1):not(h2):not(h3) {
                margin-top: 1em;
                font-size: 0.8em;
            }

            /* ä¿æŒå†…å®¹å·¦å¯¹é½ */
            .reveal .slides section:not(:first-child) {
                text-align: left;
            }

            /* åˆ—è¡¨é¡¹å·¦å¯¹é½ */
            .reveal .slides section ul,
            .reveal .slides section ol {
                display: block;
                text-align: left;
            }

            /* ä»£ç å—å·¦å¯¹é½ */
            .reveal .slides section pre {
                width: auto;
                text-align: left;
            }

            .reveal .slides section .mjx-chtml {
                text-align: left !important;
                margin-left: 0 !important;
            }

            /* æ™®é€šæ®µè½å·¦å¯¹é½ */

            .reveal .slides section {
                text-align: left;
                font-size: 40px;
            }
            .reveal .slides section p {
                text-align: left;
            }
            .reveal .slides section ul > li {
                font-size: 1em !important; /* è®¾ç½®ä¸€çº§åˆ—è¡¨é¡¹çš„å­—ä½“å¤§å° */
            }
            .reveal .slides section ul ul > li {
                font-size: 0.8em !important; /* è®¾ç½®äºŒçº§åˆ—è¡¨é¡¹çš„å­—ä½“å¤§å° */
            }
            .reveal .slides section ul ul ul > li {
                font-size: 0.7em !important; /* è®¾ç½®ä¸‰çº§åˆ—è¡¨é¡¹çš„å­—ä½“å¤§å° */
            }
            
            /* å…¬å¼å·¦å¯¹é½ */
            /* .reveal .slides section .MathJax_Display {
                text-align: left !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
            } */
            
            
            /* Slide çš„è®¾ç½® */
            .reveal .slides .slide-cols{
                display: flex;
            }
            .reveal .slides .slide-col-half{
                flex: 1;
            }
            .reveal .slides .slide-col-4{
                flex: 4;
            }
            .reveal .slides .slide-col-6{
                flex: 6;
            }

            .reveal .slides .slide-img{
                text-align: center; 
                padding: 0;
                display: block;
                border: none;
            }
            .reveal .slides .slide-ref{
                position: absolute; 
                bottom: 0; left: 0; 
                font-size: 0.5em !important;
                text-align: left; 
                width: 100%;
            }
            .reveal .slide-number {
                font-size: 1.5rem !important; /* æ”¹å˜å­—å· */
                right: 2.2em !important;
                bottom: 1.1em !important;
                background: none !important;
                color: gray !important;
            }
            .reveal .navigate-left {
                right: 6em !important;
            }
            .reveal .navigate-right {
                right: 1em !important;
            }


            body.is-fullscreen header,
            body.is-fullscreen footer,
            body.is-fullscreen main > *:not(.reveal),
            body.is-fullscreen #fullscreen-btn {
                display: none;
            }
        </style>
        
        <!-- theme -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            var theme ='white';
            switch (theme){
                case 'black':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/black.min.css';
                    break;
                case 'beige':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/beige.min.css';
                    break;
                case 'blood':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/blood.min.css';
                    break;
                case 'league':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/league.min.css';
                    break;
                case 'moon':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/moon.min.css';
                    break;
                case 'night':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/night.min.css';
                    break;
                case 'serif':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/serif.min.css';
                    break;
                case 'sky':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/sky.min.css';
                    break;
                case 'solarized':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/solarized.min.css';
                    break;
                case 'white':
                    link.href = 'https://cdn.bootcss.com/reveal.js/3.4.1/css/theme/white.min.css';
                    break;
                default:
            }
            
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>
        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/reveal.js/3.4.1/lib/css/zenburn.min.css">
        <link href="https://cdn.bootcss.com/reveal.js/3.4.1/css/print/paper.min.css" rel="stylesheet">
        <!-- Printing and PDF exports -->
        
    </head>
    <body>
        <div class="reveal">
            <button id="fullscreen-btn" title="å…¨å±æ˜¾ç¤º (ESCé€€å‡º)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                </svg>
            </button>
            <div class="slides">
                <section data-markdown
                         data-separator="^\n---\n"
                         data-separator-vertical="^\n--\n"
                         data-separator-notes="^Note:">
                    <script type="text/template">Training-Inference Mismatch In LLM KD



<small>Alephia</small>
<small>25/6/25</small>

---

## Background
æ¨¡å‹$q_{\theta}$ä¾æ®å‰ç¼€$w^{t-1}$ç”Ÿæˆæ–‡æœ¬çš„æ—¶å€™ï¼Œ$\text{loss}$å¯ä»¥è¡¨ç¤ºä¸º
$$
l(q_{\theta},w^{t-1};o) = \mathop{\mathbb{E}}\limits_{w_{t}\sim \textcolor{red}{o}(\cdot|w^{t-1})}\log \frac{o(w_{t}|w^{t-1})}{q_{\theta}(w_{t}|w^{t-1})}
$$
ç”±<mark style="background: #FF5582A6;">ç›®æ ‡åˆ†å¸ƒo</mark>é‡‡æ ·ä¸‹ä¸€ä¸ª$\text{token}$ $w_{t}$ï¼Œå†è¿›è¡Œ$\text{KLD}$å¯¹é½ã€‚
<p class="fragment">
å¯ä»¥å±•å¼€å¾—åˆ°
$$
L(q_{\theta};o) \approx \sum_{t=1}^{T}\  \mathop{\mathbb{E}}\limits_{\substack{w^{t-1}\sim d_{\textcolor{red}{o}}^{t-1} ,\ w_{t}\sim o(\cdot|w^{t-1})}}\log \frac{o(w_{t}|w^{t-1})}{q_{\theta}(w_{t}|w^{t-1})}
$$
</p>


---

## Train-Inference Mismatch
ç”±äºæ¨¡å‹èƒ½åŠ›ä¸è¶³ï¼Œç”Ÿæˆtokençš„åˆ†å¸ƒä¸ç›®æ ‡åˆ†å¸ƒå­˜åœ¨å·®è·ï¼Œè¿›è€Œæ¨¡å‹è®­ç»ƒå’Œæ¨ç†æ—¶é¢å¯¹çš„å‰ç¼€æ˜¯ä¸åŒçš„

* Distribution Mismatch (Exposure Bias)
* Error Accumulation



Distribution Mismatchä¼šå¯¼è‡´Error Accumulationï¼Œä¸”<mark style="background: #FF5582A6;">Accumulationè¡Œä¸ºæ— æ³•è¢«å·²æœ‰çš„lossæ•æ‰</mark>

<div class="slide-ref">
Arora, K., Asri, L.E., Bahuleyan, H., & Cheung, J.C. Why Exposure Bias Matters: An Imitation Learning Perspective of Error Accumulation in Language Generation.Â In ACL, 22
</div>


Note:
è®­ç»ƒæ—¶å‰ç¼€ç”±ç›®æ ‡åˆ†å¸ƒäº§ç”Ÿï¼Œæ¨ç†æ—¶å‰ç¼€ç”±æ¨¡å‹è‡ªå·±äº§ç”Ÿã€‚è¿™ä¸€é—®é¢˜æœ¬èº«åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œåˆ†å¸ƒåç§»ä»¥åŠè¯¯å·®ç´¯ç§¯

---

## Train-Inference Mismatch

æ¨¡å‹ä¸ç›®æ ‡çš„æ€»åå·®è¡¨ç¤ºä¸º
$$
\begin{flalign}
L(q_{\theta};o) &= \sum_{t=1}^{T}\  \mathop{\mathbb{E}}\limits_{\substack{w^{t-1}\sim d_{o}^{t-1} ,\ w_{t}\sim o(\cdot|w^{t-1})}}\log \frac{o(w_{t}|w^{t-1})}{q_{\theta}(w_{t}|w^{t-1})}\\\\
&= \sum_{t=1}^{T}\  \mathop{\mathbb{E}}\limits_{w^{t-1}\sim d_{o}^{t-1}} D_{KL}(o(\cdot|w^{t-1})||q_{\theta}(\cdot|w^{t-1}))
\end{flalign}
$$
è®°ç”Ÿæˆç¬¬$t$ä¸ªtokençš„æœŸæœ›è¯¯å·®ä¸º
$$
\epsilon_{t} = \mathop{\mathbb{E}}\limits_{\substack{w_{0}^{t-1}\sim d_{o}^t,\  w_{t}\sim o(\cdot| w^{t-1})}} \log \frac{o(w_{t}|w^{t-1})}{q_{\theta}(w_{t}|w^{t-1})}
$$

<div class="slide-ref">
Arora, K., Asri, L.E., Bahuleyan, H., & Cheung, J.C. Why Exposure Bias Matters: An Imitation Learning Perspective of Error Accumulation in Language Generation.Â In ACL, 22
</div>

note:
lossä»£è¡¨äº†ä¸¤ä¸ªåˆ†å¸ƒåœ¨æ–‡æœ¬å»ºæ¨¡ä¸åŒé˜¶æ®µä¸Šçš„æ€»è¯¯å·®ï¼Œåº”å½“åŒ…æ‹¬åˆ†å¸ƒçš„åç§»è¯¯å·®ä»¥åŠè¯¯å·®çš„ç´¯ç§¯éƒ¨åˆ†

---

## Train-Inference Mismatch

$$
l\epsilon_{\leq l} \leq L_{\leq l}(q_{\theta}) \leq l^2 \epsilon_{\leq l}, \ \ \epsilon_{\leq l}=\frac{1}{l} \sum_{t=1}^{l} \epsilon_{t}
$$

$$
AccErr_{\leq}(l) = \frac{L_{\leq l}(q_{\theta})}{\epsilon_{\leq l}}
$$
å¦‚æœDistribution Mismatchç¡®å®ä¼šå¯¼è‡´è¯¯å·®ç´¯ç§¯çš„è¯ï¼Œåº”å½“è§‚å¯Ÿåˆ°<mark style="background: #FF5582A6;">AccErrå€¼æ˜¯éšç€åºåˆ—é•¿åº¦å¢åŠ è€Œè¶…çº¿æ€§å¢é•¿çš„ã€‚</mark>

<p class="fragment">
<img src="https://s2.loli.net/2025/06/24/y16SeLZM2Abxpd7.png" style="width:300px; height: auto; float: center; margin-top: auto; margin-bottom: auto;border: none;">
</p>

Note:
ç¬¬ä¸€ä¸ªä¸ç­‰å·ä»£è¡¨ç´¯ç§¯è¯¯å·®çš„æœŸæœ›æœ€å°å€¼ï¼Œå³æ¯ä¸€æ­¥çš„è¯¯å·®éƒ½ä¸ä¸Šä¸€æ­¥æ— å…³ï¼Œè¯¯å·®ä¸ä¼šç´¯ç§¯ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç†æƒ³çš„æƒ…å†µã€‚è€Œç¬¬äºŒä¸ªä¸ç­‰å·ä»£è¡¨æœ€åæƒ…å†µï¼Œæ¯ä¸€æ­¥çš„è¯¯å·®çº¿æ€§ç´¯ç§¯ï¼Œæœ€ç»ˆè¡¨ç°å‡ºäºŒæ¬¡å¢é•¿çš„è¶‹åŠ¿ã€‚

---

## Train-Inference Mismatch
$$
ExAccErr_{\leq}(l) = \frac{L_{\leq l}(q_{\theta}) - l \epsilon_{\leq l}}{l \epsilon_{\leq l}} \cdot 100\%
$$

å¦‚æœä¸€ä¸ªæ¨¡å‹èƒ½å¤Ÿåšåˆ°æ¯ä¸€ä¸ªçš„æŸå¤±ä¸ä¼šç´¯ç§¯çš„è¯ï¼Œ<mark style="background: #FF5582A6;">é‚£ä¹ˆè¿™ä¸ªå€¼åº”å½“ä¸€ç›´åœ¨0å·¦å³ï¼Œå¦åˆ™ï¼Œå°±ä¼šå‘ˆä¸æ–­ä¸Šå‡çš„è¶‹åŠ¿ã€‚</mark>


<p class="fragment">
<img src="https://s2.loli.net/2025/06/25/Ipvehbk95Bza4JY.png" style="width: 300px; height: auto; float: center; margin-top: auto; margin-bottom: auto;border: none;">
</p>

Note:
$ExAccErr$å€¼ä»£è¡¨å¤šå‡ºæ¥çš„æŸå¤±æ‰€å çš„æ¯”é‡ï¼Œè€Œè¿™å®é™…ä¸Šå°±æ˜¯ç”±æŸå¤±ç´¯ç§¯å¸¦æ¥çš„


---


## Train-Inference Mismatch

$$
\begin{flalign}
\epsilon &= \frac{1}{T} \sum_{t=1}^{T} \mathop{\mathbb{E}}\limits_{\substack{w_{0}^{t-1}\sim d_{o}^t\\ w_{t}\sim o(\cdot| w_{0}^{t-1})}} \log \frac{o(w_{t}|w_{0}^{t-1})}{q_{\theta}(w_{t}|w_{0}^{t-1})}\\\\
& \approx -\frac{1}{|D|} \sum_{\substack{(w_{0}^{i-1}, w_{i})\in D}} \log q_{\theta}(w_{i}|w_{0}^{i-1}) + c\\\\
&=H(q_{\theta}; D) + c'
\end{flalign}
$$
è¿™é‡Œ$H(q_{\theta}; D)$ä»£è¡¨log Perplexity

ä¸ç®¡æ˜¯CE Lossï¼Œè¿˜æ˜¯Perplexityï¼Œéƒ½æ— æ³•ç›‘ç£errorçš„ç´¯åŠ è¿‡ç¨‹

note:
ç›®å‰çš„é—®é¢˜ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š
åˆ†å¸ƒåç§»ï¼Œæ¨¡å‹å­¦ä¹ ä¸åˆ°ä½å¼•èµ·
è¯¯å·®ç´¯ç§¯ï¼Œè¯­è¨€æ¨¡å‹è‡ªå›å½’ç”Ÿæˆå†…å®¹çš„å½¢å¼å¯¼è‡´
å¤§éƒ¨åˆ†è§£å†³æ–¹æ³•**éƒ½æ˜¯é’ˆå¯¹ç¬¬ä¸€éƒ¨åˆ†**ï¼Œåˆ†å¸ƒåç§»

---

## The Utilization of SGO

å¼•å…¥æ¨¡å‹è‡ªå·±æ¨ç†ç”Ÿæˆçš„å†…å®¹ç”¨äºè®­ç»ƒ(**S**tudent **G**enerated **O**utput)

$$
L_{SGO}(q_{\theta};o) = \sum_{t=1}^{T}\  \mathop{\mathbb{E}}\limits_{\substack{w^{t-1}\sim d_{\textcolor{red}{q_{\theta}}}^{t-1} ,\ w_{t}\sim o(\cdot|w^{t-1})}}\log \frac{o(w_{t}|w^{t-1})}{q_{\theta}(w_{t}|w^{t-1})}
$$

æ¯æ¬¡æœ‰$\lambda$çš„æ¦‚ç‡ä½¿ç”¨SGOï¼Œ$1-\lambda$çš„æ¦‚ç‡ä½¿ç”¨è®­ç»ƒé›†æ ·æœ¬
<img src="https://s2.loli.net/2025/06/25/Vl6m7Q1ctbUMak9.png" style="width: 450px; height: auto; float: left; margin-top: auto; margin-bottom: auto;border: none;">

<img src="https://s2.loli.net/2025/06/25/6dEeDws4tZNA2Hu.png" style="width: 450px; height: auto; float: right; margin-top: auto; margin-bottom: auto;border: none;">

<div class="slide-ref">
Agarwal, R., Vieillard, N., Zhou, Y., StaÅ„czyk, P., Ramos, S., Geist, M., & Bachem, O.  On-Policy Distillation of Language Models: Learning from Self-Generated Mistakes. In ICLR, 24
</div>

note:
æ¯æ¬¡SGOæ¥è‡ªå½“å‰å‚æ•°ä¸‹å­¦ç”Ÿç”Ÿæˆçš„ç»“æœï¼ŒOn-Policy

æ¯æ¬¡éƒ½è¦å­¦ç”Ÿé‡æ–°ç”ŸæˆSGOï¼Œåˆ©ç”¨ç‡ä½ï¼Œè®¡ç®—å¼€é”€å¤§

å­¦ç”Ÿè¿˜è¦è·ŸSGOå¯¹é½ï¼Œå½“SGOè´¨é‡è¾ƒå·®çš„æ—¶å€™ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å½±å“

---

## The Utilization of SGO

* ä½¿ç”¨SGOæ—¶ï¼ŒTeacherä¹Ÿé¢ä¸´Train-Inference Mismatchï¼Œä¼šå¸¦æ¥å™ªå£° <p class="fragment"> ğŸ’¡ <mark style="background: #FF5582A6;">æ›´åŠ ä¿å®ˆåœ°ä½¿ç”¨SGO</mark></p>
* æ¯æ¬¡éƒ½è¦å­¦ç”Ÿé‡æ–°ç”ŸæˆSGOï¼Œåˆ©ç”¨ç‡ä½ï¼Œè®¡ç®—å¼€é”€å¤§ <p class="fragment">ğŸ’¡ <mark style="background: #FF5582A6;">on-policy -> off-policy</mark></p>

<img src="https://s2.loli.net/2025/06/25/N2pXnCckbBIfhie.png" style="width: 500px; height: auto; float: center; margin-top: auto; margin-bottom: auto;border: none;">

<div class="slide-ref">
Ko, J., Kim, S., Chen, T., & Yun, S. DistiLLM: Towards Streamlined Distillation for Large Language Models.Â In ICML, 24
</div>

note:
ç›´æ¥å˜æˆoff-policyï¼Œå¯¹ä¸åŒè®­ç»ƒé˜¶æ®µäº§å‡ºçš„SGOæœä»çš„åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚æ²¡æœ‰çº¦æŸ


---

## The Utilization of SGO

<img src="https://s2.loli.net/2025/06/25/SAtfpY2djBkw4WP.png" style="width: 500px; height: auto; float: center; margin-top: auto; margin-bottom: auto;border: none;">

Loss $\uparrow$ï¼ŒROUGE_L $\uparrow$

"Our observations indicate that training on a diverse range of SGOs, rather than solely on a fixed dataset, mitigates training-inference mismatch and consequently lowers validation loss"

è¿‡æ‹Ÿåˆï¼Ÿtrain-inference mismatchï¼Ÿ
æŒ‡æ ‡ä¸lossçš„ä¸åŒ¹é…ï¼Ÿ

Note:
ä¸æ­¢æ˜¯LLM KDåœºæ™¯ï¼Œåªæ˜¯å¾®è°ƒä¹Ÿæœ‰è¿™ç§ç°è±¡ï¼Œè¿™åº”å½“æ˜¯ä¸€ç§æ™®éç°è±¡ã€‚

Distillmå°†éªŒè¯é›†ä¸ŠLossä¸Šæ¶¨è§£é‡Šä¸ºexposure biasï¼Œä½†æ˜¯è¿™åº”è¯¥åªèƒ½è§£é‡ŠéªŒè¯é›†lossé«˜ï¼Œä½†ä¸èƒ½è§£é‡Šä¸ºä»€ä¹ˆlossåœ¨ä¸æ–­ä¸Šæ¶¨

|Train-set|:|Vaild-set|=14:1 


---

## Introduce Sample-Wise Weight

$P$ä¸ºçœŸå®åˆ†å¸ƒï¼Œ$Q$ä¸ºåˆæˆæ•°æ®åˆ†å¸ƒï¼Œ$q_{\theta}$ä¸ºæ¨¡å‹é¢„æµ‹åˆ†å¸ƒ

$$
E_{Q}[-\log q_{\theta}(y|x;\theta)]
$$

$$
E_{Q}\left[ -\frac{P(y|x)}{Q(y|x)} \log q_{\theta}(y|x;\theta) \right] = E_{P}[-\log q_{\theta}(y|x;\theta)]
$$

$P(y|x)$å¤§ï¼Œæ•°æ®ç‚¹ä¸çœŸå®åˆ†å¸ƒé«˜åº¦ç›¸å…³ä¸”æ˜ç¡®ï¼Œæœ‰å‚è€ƒæ„ä¹‰ã€‚$Q(y|x)$è¶Šå°ï¼Œæ•°æ®ç‚¹åœ¨åˆ†å¸ƒ$Q$ä¸­æ‰€åŒ…å«çš„ä¿¡æ¯è¶Šå¤šã€‚

<div class="slide-ref">
Kuo, H., Liao, Y., Chao, Y., Ma, W., & Cheng, P. Not All LLM-Generated Data Are Equal: Rethinking Data Weighting in Text Classification.Â In ICLR, 25
</div>

Note:
èƒŒæ™¯ä¸ºä½¿ç”¨åˆæˆæ•°æ®è¿›è¡Œè®­ç»ƒ
SGO: åœ¨ä¸€äº›ä¸ç›®æ ‡åˆ†å¸ƒç›¸å·®è¾ƒå¤§çš„æ ·æœ¬å‰ç¼€ä¸Šï¼Œä¹Ÿå­¦åˆ°å‘ç›®æ ‡åˆ†å¸ƒé è¿‘çš„å€¾å‘

---

## Introduce Sample-Wise Weight

åŠ æƒç­–ç•¥æ›´æ–°ä¸º
$$
E_{Q}\left[ -\frac{q_{\theta}(y|x;\theta,D_{P'})}{q_{\theta}(y|x;\theta)} \log q_{\theta}(y|x;\theta) \right]
$$

$q_{\theta}(y|x)$è¶Šå°ï¼Œæ¨¡å‹åœ¨è¿™ä¸ªæ•°æ®ç‚¹ä¸Šå­¦çš„è¶Šå·®ï¼Œè¶Šåº”æ³¨é‡

<img src="https://s2.loli.net/2025/06/23/WRFG1DqZ7JT8j2s.png" style="width: 500px; height: auto; float: center; margin-top: auto; margin-bottom: auto;border: none;">
Note:
åŠ¨æ€èµ‹æƒ

---

## Thinkings

<p class="fragment">
ğŸ¤” Add weight to SGO ï¼Ÿ
</p>


<p class="fragment">
$$
L_{WSGO}(q_{\theta};o) =\sum_{t=1}^{T}\  \mathop{\mathbb{E}}\limits_{w^{t-1}\sim d_{o}^{t-1}} \lambda(t-1, w^{t-1}) D_{KL}(o(\cdot|w^{t-1})||q_{\theta}(\cdot|w^{t-1}))
$$
</p>

<p class="fragment">
ğŸ¤” When using SGO, add adaptive weight for $L_{Base}$ w.r.t $L_{KD}$ ?
</p>

<p class="fragment">
$$
L = L_{KD} + \phi_{epoch} L_{Base}
$$
</p>

<p class="fragment">
ğŸ¤” Deeper research in teacher's response to SGO ?
</p>

<p class="fragment">
ğŸ¤” How to solve error accumulation?
</p>

Note:
å­¦ç”Ÿéœ€è¦ä¸SGOå¯¹é½æ˜¯å¦æœ‰å¿…è¦ï¼Ÿ

---

## LLM KD With Different Vocabularies

æ•™å¸ˆ$(m\times D)$å‘å­¦ç”Ÿ$(n\times d)$å¯¹é½ï¼š
$$
Q = P^q([e_{1:n}^s; e_{2:n+1}^s];\theta_{P}^q)\in R^{n\times 2D}
$$
$$
K = [e_{1:m}^t;e_{2:m+1}^t]\in R^{m\times 2D}
$$
$$
V = P^v(e_{2:m+1}^t+h_{1:m}^t; \theta_{P}^v)\in R^{m\times d}
$$


<div class="slide-ref">
Zhang, S., Zhang, X., Sun, Z., Chen, Y., & Xu, J. Dual-Space Knowledge Distillation for Large Language Models.Â In EMNLP, 24
</div>

Note:
Vçš„è®¾è®¡æ˜¯ç›®æ ‡tokensçš„åˆå§‹emd+è¾“å…¥tokensçš„æœ€åä¸€å±‚emb

è¿‡å­¦ç”Ÿçš„æ˜ å°„å¤´ï¼Œæœ‰åŠ©äºç»Ÿä¸€ä¸¤è€…çš„è¾“å‡ºç©ºé—´

---

## LLM KD With Different Vocabularies

æ•™å¸ˆå˜æ¢åçš„emdå¯ä»¥è¡¨ç¤ºä¸º

$$
h^{t \rightarrow s}_{1:n} = softmax(\frac{QK^T}{\sqrt{ 2D }}V)\in R^{n\times d}
$$

æœ€åè¿‡å­¦ç”Ÿçš„æ˜ å°„å¤´å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒ

$$
p^t = softmax(h^{t \rightarrow s}\_{1:n}\\textcolor{red}{W_{S}})
$$


---

## Thanks!



</script>

                </section>
            </div>
        </div>

        <script>
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']],
                    processEscapes: true,
                    processEnvironments: true,
                    packages: {'[+]': ['base', 'ams', 'amsmath', 'amssymb']}
                },
                options: {
                    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                }
            };
        </script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

        <!-- <script src="https://cdn.bootcss.com/reveal.js/3.4.1/lib/js/head.min.js"></script>
        <script src="https://cdn.bootcss.com/reveal.js/3.4.1/js/reveal.min.js"></script> -->
        <!-- <script src="/reveal.js/plugin/math/mathjax2.js"></script> -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/dist/reveal.min.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/math/math.js"></script> -->
        <!-- <script src="/reveal.js/plugin/math/math.js"></script> -->

        <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/markdown/markdown.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/highlight/highlight.js"></script>

        <!-- Notesæ’ä»¶ -->
        <script src="https://cdn.jsdelivr.net/npm/reveal.js@5.2.1/plugin/notes/notes.js"></script>



        <script>
            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                plugins: [ RevealMarkdown, RevealHighlight, RevealNotes],
                
                // math: {
                //     mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
                //     config: 'TeX-AMS_HTML-full',
                //     tex: {
                //         inlineMath: [['$', '$'], ['\\(', '\\)']],
                //         displayMath: [['$$', '$$'], ['\\[', '\\]']],
                //         processEscapes: true,
                //         processEnvironments: true,
                //         packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
                //     }
                // },
                // å¹»ç¯ç‰‡è·ç¦»æµè§ˆå™¨è¾¹ç¼˜çš„ç™¾åˆ†æ¯”ï¼ˆ0 - 1ï¼‰
                margin: 0.1,  
                
                // ç¼©å°æ—¶æœ€å°ç¼©æ”¾æ¯”ä¾‹
                minScale: 0.2, 

                // æ”¾å¤§æ—¶æœ€å¤§ç¼©æ”¾æ¯”ä¾‹
                maxScale: 2.0, 

                // åœ°å€æ  hash åæ˜ å½“å‰é¡µï¼Œæ–¹ä¾¿åˆ†äº«é“¾æ¥å®šä½åˆ°æŸé¡µ
                hash: true,

                history: true,

                // æ˜¯å¦åœ¨å³ä¸‹è§’å±•ç¤ºæ§åˆ¶æ¡
                controls: true,

                // æ˜¯å¦æ˜¾ç¤ºæ¼”ç¤ºçš„è¿›åº¦æ¡
                progress: true,

                // æ˜¯å¦æ˜¾ç¤ºå½“å‰å¹»ç¯ç‰‡çš„é¡µæ•°ç¼–å·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç  â€œslideNumber: 'c/t'â€ ï¼Œè¡¨ç¤ºå½“å‰é¡µ/æ€»é¡µæ•°ã€‚
                slideNumber: true,

                // æ˜¯å¦å°†æ¯ä¸ªå¹»ç¯ç‰‡æ”¹å˜åŠ å…¥åˆ°æµè§ˆå™¨çš„å†å²è®°å½•ä¸­å»
                history: false,

                // æ˜¯å¦å¯ç”¨é”®ç›˜å¿«æ·é”®æ¥å¯¼èˆª
                keyboard: true,

                // æ˜¯å¦å¯ç”¨å¹»ç¯ç‰‡çš„æ¦‚è§ˆæ¨¡å¼ï¼Œå¯ä½¿ç”¨ "Esc" æˆ– "o" é”®æ¥åˆ‡æ¢æ¦‚è§ˆæ¨¡å¼
                overview: true,

                // æ˜¯å¦å°†å¹»ç¯ç‰‡å‚ç›´å±…ä¸­
                center: true,

                // æ˜¯å¦åœ¨è§¦å±è®¾å¤‡ä¸Šå¯ç”¨è§¦æ‘¸æ»‘åŠ¨åˆ‡æ¢
                touch: true,

                // æ˜¯å¦å¾ªç¯æ¼”ç¤º
                loop: false,

                // æ˜¯å¦å°†æ¼”ç¤ºçš„æ–¹å‘å˜æˆ RTLï¼Œå³ä»å³å¾€å·¦
                rtl: false,

                // æ˜¯å¦æ¯æ¬¡æ¼”ç¤ºçš„æ—¶å€™ï¼Œéšæœºå¹»ç¯ç‰‡çš„é¡ºåº
                shuffle: false,

                // å…¨å±€å¼€å¯å’Œå…³é—­ç¢ç‰‡ã€‚
                fragments: true,

                // æ ‡è¯†æ¼”ç¤ºæ–‡ç¨¿æ˜¯å¦åœ¨åµŒå…¥æ¨¡å¼ä¸­è¿è¡Œï¼Œå³åŒ…å«åœ¨å±å¹•çš„æœ‰é™éƒ¨åˆ†ä¸­çš„
                embedded: false,

                // æ ‡è¯†å½“é—®å·é”®è¢«ç‚¹å‡»çš„æ—¶å€™æ˜¯å¦åº”è¯¥æ˜¾ç¤ºä¸€ä¸ªå¸®åŠ©çš„è¦†ç›–å±‚
                help: true,

                // æ ‡è¯†æ¼”è®²è€…å¤‡æ³¨æ ‡å¿—æ˜¯å¦è®©æ‰€æœ‰è§‚çœ‹è€…å¯è§
                showNotes: false,

                // ä¸¤ä¸ªå¹»ç¯ç‰‡ä¹‹é—´è‡ªåŠ¨åˆ‡æ¢çš„æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰
                // å½“è®¾ç½®æˆ 0 çš„æ—¶å€™åˆ™ç¦æ­¢è‡ªåŠ¨åˆ‡æ¢
                // è¯¥å€¼å¯ä»¥è¢«å¹»ç¯ç‰‡ä¸Šçš„ â€œdata-autoslideâ€ å±æ€§è¦†ç›–
                autoSlide: 0,
                // å½“é‡åˆ°ç”¨æˆ·è¾“å…¥çš„æ—¶å€™åœæ­¢è‡ªåŠ¨åˆ‡æ¢
                autoSlideStoppable: true,
                // å½“è‡ªåŠ¨æ»‘åŠ¨æ—¶ï¼Œä½¿ç”¨æ­¤æ–¹æ³•è¿›è¡Œå¯¼èˆªã€‚
                autoSlideMethod: Reveal.navigateNext,

                // æ˜¯å¦å¯ç”¨é€šè¿‡é¼ æ ‡æ»šè½®æ¥å¯¼èˆªå¹»ç¯ç‰‡
                mouseWheel: true,

                // æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šéšè—åœ°å€æ 
                hideAddressBar: true,
                // æ˜¯å¦åœ¨ä¸€ä¸ªå¼¹å‡ºçš„ iframe ä¸­æ‰“å¼€å¹»ç¯ç‰‡ä¸­çš„é“¾æ¥
                previewLinks: false,
                // åˆ‡æ¢è¿‡æ¸¡æ•ˆæœ
                transition: 'none', // none/fade/slide/convex/concave/zoom
                // è¿‡æ¸¡é€Ÿåº¦
                transitionSpeed: 'default', // default/fast/slow
                // å…¨å±å¹»ç¯ç‰‡èƒŒæ™¯çš„è¿‡æ¸¡æ•ˆæœ
                backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom

                // åŠ è½½é™¤å½“å‰å¯è§çš„å¹»ç¯ç‰‡ä¹‹å¤–çš„å¹»ç¯ç‰‡æ•°é‡
                viewDistance: 3,

                // è§†å·®èƒŒæ™¯å›¾ç‰‡
                parallaxBackgroundImage: '',
                // e.g. 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'
                // è§†å·®èƒŒæ™¯å°ºå¯¸
                parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"
                // ç§»åŠ¨è§†å·®èƒŒæ™¯ï¼ˆæ°´å¹³å’Œå‚ç›´ï¼‰æ»‘åŠ¨å˜åŒ–çš„æ•°é‡, ä¾‹å¦‚ 100
                // - é™¤äº†æŒ‡å®šè‡ªåŠ¨è®¡ç®—
                // - è®¾ç½®ä¸º 0 æ—¶ï¼Œç¦æ­¢æ²¿è½´è¿åŠ¨
                parallaxBackgroundHorizontal: null,
                parallaxBackgroundVertical: null,
            });
            Reveal.on('slidechanged', function() {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    MathJax.typesetPromise();
                }
            });

            // è·å–æ‰€æœ‰éœ€è¦çš„å…ƒç´ 
            const revealElement = document.querySelector('.reveal');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const laserBtn = document.getElementById('laser-btn');
            const laserPointer = document.querySelector('.laser-pointer');
            const laserPositionInput = document.getElementById('laser-position');
            
            let isFullscreen = false;
            let isLaserActive = false;

            // æ£€æµ‹æ˜¯å¦åœ¨æ¼”ç¤ºè€…è§†å›¾ä¸­
            function isInPresenterView() {
                // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰speakeræˆ–noteså‚æ•°
                return window.location.search.includes('receiver');
            }

            // æ£€æµ‹æ˜¯å¦åœ¨å±•ç¤ºè§†å›¾ä¸­
            function isInPresentationView() {
            return !isInPresenterView() && window.opener;
            }
    
            // æ£€æµ‹æ˜¯å¦åœ¨ä¸»è§†å›¾
            function isInMainView() {
            return !isInPresenterView() && !window.opener;
            }
    
            // å®šä¹‰ä¸€ä¸ªç®€å•ç²—æš´çš„æœ¬åœ°å­˜å‚¨é”®ï¼Œç”¨äºåœ¨æ¼”ç¤ºè€…è§†å›¾å’Œå±•ç¤ºè§†å›¾ä¹‹é—´é€šä¿¡
            const LASER_KEY = 'reveal_laser_pointer_position';
            const LASER_ACTIVE_KEY = 'reveal_laser_active_state';

            // å…¨å±æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            fullscreenBtn.addEventListener('click', function() {
                isFullscreen = !isFullscreen;
                document.body.classList.toggle('is-fullscreen', isFullscreen);
                revealElement.classList.toggle('fullscreen', isFullscreen);
                
                if (isFullscreen) {
                    document.documentElement.requestFullscreen();
                    laserBtn.style.display = 'flex';
                    Reveal.layout();
                } else {
                    cleanupLaserPointer();
                }
            });

            // ç›‘å¬å…¨å±çŠ¶æ€å˜åŒ–
            document.addEventListener('fullscreenchange', function() {
            if (!document.fullscreenElement) {
                cleanupLaserPointer();
                Reveal.layout();
            }
            });

            // ESC é”®å¤„ç†
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // åŒºåˆ†æ¼”ç¤ºè€…è§†å›¾å’Œå…¶ä»–è§†å›¾çš„å¤„ç†
                    if (isInPresenterView()) {
                    // åœ¨æ¼”ç¤ºè€…è§†å›¾ä¸­ï¼ŒESC é”®åªé€€å‡ºå…¨å±ï¼Œä¸å…³é—­æ¿€å…‰ç¬”
                    if (isFullscreen || document.fullscreenElement) {
                        if (document.fullscreenElement) {
                        document.exitFullscreen();
                        }
                        isFullscreen = false;
                        document.body.classList.remove('is-fullscreen');
                        revealElement.classList.remove('fullscreen');
                        // ä¸å…³é—­æ¿€å…‰ç¬”ï¼Œä½†åœ¨æ¼”è®²è€…æ¨¡å¼ä¸‹æŒ‰é’®ä¿æŒéšè—
                        laserBtn.style.display = 'none';
                        Reveal.layout();
                    }
                    } else {
                    // åœ¨å…¶ä»–è§†å›¾ä¸­ï¼ŒESC é”®è¡Œä¸ºä¸å˜
                    cleanupLaserPointer();
                    }
                }
                    // Alt é”®åˆ‡æ¢æ¿€å…‰ç¬”ï¼ˆåœ¨æ‰€æœ‰è§†å›¾ä¸­éƒ½æœ‰æ•ˆï¼‰
                if (e.key === 'Alt') {
                    e.preventDefault(); // é˜²æ­¢è§¦å‘æµè§ˆå™¨é»˜è®¤è¡Œä¸º
                    toggleLaser(!isLaserActive);
                }
            });
                
            // æ·»åŠ  Alt é”®é‡Šæ”¾å¤„ç†
            document.addEventListener('keyup', function(e) {
            if (e.key === 'Alt') {
                e.preventDefault(); // é˜²æ­¢è§¦å‘æµè§ˆå™¨é»˜è®¤è¡Œä¸º
            }
            });

            document.addEventListener('DOMContentLoaded', () => {
                const refs = document.querySelectorAll('.slide-ref');

                refs.forEach(ref => {
                    const lines = ref.textContent.split('\n').map(line => line.trim()).filter(line => line.length > 0);

                    ref.innerHTML = `
                    <div style="width: 100px; height: 1px; background: black; margin-bottom: 5px;"></div>
                    <p style="margin: 2px 0;">${lines.join('<br>')}</p>
                    `;
                });
            });

        </script>
    </body>
</html>
